Rolle
Du agierst als Senior Full-Stack Engineer & Product Architect.
Du arbeitest inkrementell auf einer bestehenden Codebasis auf (keine komplette Neuentwicklung erzwingen).
Du darfst vorhandene Module wiederverwenden, aber du musst fehlende Logik sauber ergÃ¤nzen.

ðŸ§  Fachlicher Kontext

Es existiert ein Automotive-Werk mit:

Hallen

Stationen

StÃ¤ndern (StÃ¤ndername = festes Material)

Boxen (BehÃ¤lter), die physisch wechseln kÃ¶nnen

Lagercontainern je Material mit KapazitÃ¤tsgrenzen

Alle relevanten EntitÃ¤ten sind per QR-Code eindeutig identifizierbar.

Die App dient dazu, MaterialflÃ¼sse nachvollziehbar, scan-basiert und revisionssicher abzubilden.

ðŸ” Grundprinzip (sehr wichtig)

Material wird NICHT an der Box gespeichert

Material ergibt sich immer Ã¼ber den StÃ¤nder, an dem die Box aktuell steht

Box = bewegliches Objekt

StÃ¤nder = Materialdefinition

ðŸ§© Kern-Workflows
1ï¸âƒ£ Box-Positionierung

Nutzer scannt:

Station-QR

StÃ¤nder-QR

Box-QR

System speichert:

Box X steht jetzt an Station Y, Halle Z, StÃ¤nder S

Jede Ã„nderung erzeugt ein Audit-Event

2ï¸âƒ£ Task-Typen
Task-Typ A: TÃ¤glich volle BehÃ¤lter

Bestimmte StÃ¤nder sind als dailyFull=true markiert

FÃ¼r diese wird jeden Tag automatisch ein Task im Status OPEN erzeugt

Diese Tasks sind immer sichtbar, auch ohne manuelle Meldung

Task-Typ B: UnregelmÃ¤ÃŸig volle BehÃ¤lter

Entstehen manuell:

durch Admin

oder durch Scan + Aktion â€žBehÃ¤lter vollâ€œ

Task enthÃ¤lt:

Box

abgeleitetes Material (Ã¼ber StÃ¤nder)

Station/Halle

3ï¸âƒ£ Task-Lebenszyklus (State Machine â€“ zwingend)
OPEN
â†’ PICKED_UP
â†’ IN_TRANSIT
â†’ DROPPED_OFF
â†’ TAKEN_OVER
â†’ WEIGHED
â†’ DISPOSED


Abbruch jederzeit durch CANCELLED (nur Admin).

ÃœbergÃ¤nge mÃ¼ssen serverseitig validiert werden (409 bei VerstoÃŸ).

4ï¸âƒ£ Lager & Wiegen

Lagercontainer:

sind materialgebunden

haben KapazitÃ¤t (kg)

kÃ¶nnen isFull oder isBlocked sein

Beim Ãœbergang TAKEN_OVER â†’ WEIGHED:

Gewichtseingabe (weightKg) ist Pflicht

ohne Gewicht â†’ kein Abschluss mÃ¶glich

System schlÃ¤gt automatisch einen passenden Lagercontainer vor:

gleiches Material

nicht voll

nicht blockiert

ðŸ‘¥ Rollen & Rechte
ADMIN
PICKUP_DRIVER
WAREHOUSE
DISPOSAL


PICKUP_DRIVER: Abholung & Transport

WAREHOUSE: Abstellen & Ãœbernahme

DISPOSAL: Wiegen & Entsorgen

ADMIN: Stammdaten + Korrekturen + Cancel

ðŸ—‚ï¸ Zwingende Datenmodelle (Erweiterung erlaubt)

Hall

Station

Stand (StÃ¤nder, enthÃ¤lt materialId, dailyFull Flag)

Material

Box

WarehouseContainer

Task

TaskEvent (Audit)

User

Zwingende Regel

Eine Box darf niemals gleichzeitig in zwei aktiven Tasks sein
(status NOT IN [DISPOSED, CANCELLED] â†’ sonst 409)

ðŸ§ª Audit & Nachvollziehbarkeit (Pflicht)

Bei jedem:

Scan

Statuswechsel

Standortwechsel

manuellen Eingriff

muss ein TaskEvent oder AuditEvent geschrieben werden mit:

actorUserId

action

entityType

entityId

before/after JSON

timestamp

ðŸ“± Mobile App (Scan-First UX)
Screens (Minimum)

Login

Task-Ãœbersicht (Tabs nach Status)

QR-Scan

Task-Detail

Gewicht-Eingabe (Pflicht)

Admin-Bereich (optional Web)

UX-Regel

Nach QR-Scan keine langen Formulare

App zeigt kontextabhÃ¤ngige Aktion

z. B. â€žAbholenâ€œ, â€žAbstellenâ€œ, â€žÃœbernehmenâ€œ, â€žWiegenâ€œ

ðŸ§  Technische Vorgaben (einhalten)

Backend: Node.js + NestJS + Prisma + PostgreSQL

Mobile: React Native (Expo) + TypeScript

Auth: JWT

Validation: zod

Online-only (kein Offline-Sync nÃ¶tig)

ðŸ”’ Pflicht-Code: Transition Guard (muss existieren)
export function assertTransition(from, to) {
  const allowed = {
    OPEN: ["PICKED_UP"],
    PICKED_UP: ["IN_TRANSIT"],
    IN_TRANSIT: ["DROPPED_OFF"],
    DROPPED_OFF: ["TAKEN_OVER"],
    TAKEN_OVER: ["WEIGHED"],
    WEIGHED: ["DISPOSED"],
  };

  if (to === "CANCELLED") return;
  if (!allowed[from]?.includes(to)) {
    throw new Error(`Invalid transition ${from} -> ${to}`);
  }
}


Diese Logik darf nicht im Frontend liegen.